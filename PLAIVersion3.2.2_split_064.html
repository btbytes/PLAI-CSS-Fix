<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Unknown</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link rel="stylesheet" type="text/css" href="stylesheet.css"/>
<link rel="stylesheet" type="text/css" href="page_styles.css"/>
</head>
  <body class="c">
<h2 class="c27" id="h.sfk1bknlljs8"><span class="c4">A Truthy/Falsy Idiom</span></h2><p class="c3"><span class="c4"></span></p><p class="c5"><span class="calibre3">Unrelated to macros, here’s something we often see in truthy/falsy languages. Consider a two-arm </span><span class="c28">or</span><span class="calibre3">, which we can define as a macro:</span></p><p class="c3"><span class="c72"></span></p><p class="c5"><span class="c41">(define-syntax or-2</span></p><p class="c5"><span class="c41">  (syntax-rules ()</span></p><p class="c5"><span class="c41">    [(_ e1 e2)</span></p><p class="c5"><span class="c41">     (if e1</span></p><p class="c5"><span class="c41">         true</span></p><p class="c5"><span class="c28">         e2)]))</span></p><p class="c3"><span class="c72"></span></p><p class="c5"><span class="c4">This works well enough for</span></p><p class="c3"><span class="c72"></span></p><p class="c5"><span class="c41">(or-2 true false)</span></p><p class="c5"><span class="c41">(or-2 false false)</span></p><p class="c5"><span class="c41">(or-2 false true)</span></p><p class="c3"><span class="c4"></span></p><p class="c5"><span class="calibre3">However, consider a function like </span><span class="c28">member</span><span class="c4">:</span></p><p class="c3"><span class="c72"></span></p><p class="c31"><span class="c41">(member 'y '(x y z))</span></p><p class="c3"><span class="c4"></span></p><p class="c5"><span class="calibre3">When it succeeds, it doesn’t just return </span><span class="c28">true</span><span class="calibre3">, it returns the entire rest of the list (which is a truthy value). But if we combine this with </span><span class="c28">or-2</span><span class="c4">:</span></p><p class="c3"><span class="c4"></span></p><p class="c5"><span class="c41">(or-2 (member 'y '(x y z)) "not found")</span></p><p class="c3"><span class="c4"></span></p><p class="c5"><span class="c4">This is clearly not the result we want: we’ve lost the useful return value. Instead, here’s a different macro that returns rather than suppressing that result:</span></p><p class="c3"><span class="c4"></span></p><p class="c5"><span class="c41">(define-syntax or-2</span></p><p class="c5"><span class="c41">  (syntax-rules ()</span></p><p class="c5"><span class="c41">    [(_ e1 e2)</span></p><p class="c5"><span class="c41">     (if e1</span></p><p class="c5"><span class="c41">         e1</span></p><p class="c5"><span class="c41">         e2)]))</span></p><p class="c3"><span class="c4"></span></p><p class="c5"><span class="c4">This makes</span></p><p class="c3"><span class="c4"></span></p><p class="c5"><span class="c41">(or-2 (member 'y '(x y z)) "not found")</span></p><p class="c3"><span class="c4"></span></p><p class="c5"><span class="c4">work as expected. </span></p></body></html>
