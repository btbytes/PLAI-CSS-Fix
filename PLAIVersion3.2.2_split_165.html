<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Unknown</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link rel="stylesheet" type="text/css" href="stylesheet.css"/>
<link rel="stylesheet" type="text/css" href="page_styles.css"/>
</head>
  <body class="c">
<h2 class="c27" id="h.h0rx77tbfh7k"><span class="c4">Interaction with State</span></h2><p class="c3"><span class="c4"></span></p><p class="c5"><span class="c4">Now let’s think about how all this interacts with state. Let’s write a simple Web program that simply counts how many times we submitted a form.</span></p><p class="c3"><span class="c4"></span></p><p class="c5"><span class="calibre3">One natural way to write it is as follows. We’ll have a mutable variable, </span><span class="c28">count</span><span class="c4">, that keeps the count. We’ll have a page that shows the current count and provides the user a button. When they click it, computation resumes; the resumed computation increments the count, and loops:</span></p><p class="c3"><span class="c4"></span></p><p class="c5"><span class="c41">#lang web-server/insta</span></p><p class="c3"><span class="c41"></span></p><p class="c5"><span class="c41">(define count 0)</span></p><p class="c3"><span class="c41"></span></p><p class="c5"><span class="c41">(define (show-count)</span></p><p class="c5"><span class="c41">  (send/suspend</span></p><p class="c5"><span class="c41">     (lambda (k-url)</span></p><p class="c5"><span class="c41">       (response/xexpr</span></p><p class="c5"><span class="c41">        `(html (head "Counter")</span></p><p class="c5"><span class="c41">               (body</span></p><p class="c5"><span class="c41">                (p () "The current count is " ,(number-&gt;string count))</span></p><p class="c5"><span class="c41">                (form ([action ,k-url])</span></p><p class="c5"><span class="c41">                      (input ([type "submit"])))))))))</span></p><p class="c3"><span class="c41"></span></p><p class="c5"><span class="c41">(define (start req)</span></p><p class="c5"><span class="c41">  (show-count)</span></p><p class="c5"><span class="c41">  (set! count (add1 count))</span></p><p class="c5"><span class="c41">  (start 'dummy))</span></p><p class="c3"><span class="c4"></span></p><p class="c5"><span class="calibre3">We’ll call it the </span><span class="c7">stateful counter</span><span class="c4">.</span></p><p class="c3"><span class="c4"></span></p><p class="c5"><span class="c4">This works as you might expect. </span></p><p class="c3"><span class="c4"></span></p><p class="c5"><span class="c4">But now let’s think about a different way to write this same program. Instead of using a global mutable variable, we could instead keep the count as a local variable and functionally update it:</span></p><p class="c3"><span class="c4"></span></p><p class="c5"><span class="c41">#lang web-server/insta</span></p><p class="c3"><span class="c41"></span></p><p class="c5"><span class="c41">(define (show-count count)</span></p><p class="c5"><span class="c41">  (send/suspend</span></p><p class="c5"><span class="c41">     (lambda (k-url)</span></p><p class="c5"><span class="c41">       (response/xexpr</span></p><p class="c5"><span class="c41">        `(html (head "Counter")</span></p><p class="c5"><span class="c41">               (body</span></p><p class="c5"><span class="c41">                (p () "The current count is " ,(number-&gt;string count))</span></p><p class="c5"><span class="c41">                (form ([action ,k-url])</span></p><p class="c5"><span class="c41">                      (input ([type "submit"])))))))))</span></p><p class="c3"><span class="c41"></span></p><p class="c5"><span class="c41">(define (loop count)</span></p><p class="c5"><span class="c41">  (show-count count)</span></p><p class="c5"><span class="c41">  (loop (add1 count)))</span></p><p class="c3"><span class="c41"></span></p><p class="c5"><span class="c41">(define (start req)</span></p><p class="c5"><span class="c41">  (loop 0))</span></p><p class="c3"><span class="c4"></span></p><p class="c5"><span class="calibre3">We’ll call this the </span><span class="c7">functional counter</span><span class="c4">.</span></p><p class="c3"><span class="c4"></span></p><p class="c5"><span class="calibre3">This, too, works as you would expect. And it works the same as the previous program. And yet, somehow, these programs seem to be different. Are they in fact </span><span class="c7">exactly</span><span class="c4"> the same?</span></p><p class="c3"><span class="c4"></span></p><p class="c5"><span class="c4">They’re not!</span></p><p class="c3"><span class="c4"></span></p><p class="c31"><span class="c40">Exercise: </span><span class="c4">Map out the stacks, environments, and stores to simulate how these programs would run.</span></p></body></html>
