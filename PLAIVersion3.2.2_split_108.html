<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Unknown</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link rel="stylesheet" type="text/css" href="stylesheet.css"/>
<link rel="stylesheet" type="text/css" href="page_styles.css"/>
</head>
  <body class="c">
<h2 class="c27" id="h.qgdclmmudlfd"><span class="c4">Revisiting the Basic Calculator</span></h2><p class="c3"><span class="c4"></span></p><p class="c5"><span class="c4">We will start with a very basic calculator that has two types, numbers and strings, and an operation (addition and concatenation, respectively) on them. Note that it helps to have more than one type if we want to talk about safety. We will skip most of the boilerplate code and focus on the core of the calculator:</span></p><p class="c3"><span class="c4"></span></p><p class="c5"><span class="c41">(define-type Exp</span></p><p class="c5"><span class="c41">  [num (n : Number)]</span></p><p class="c5"><span class="c41">  [str (s : String)]</span></p><p class="c5"><span class="c41">  [plus (l : Exp) (r : Exp)]</span></p><p class="c5"><span class="c41">  [cat (l : Exp) (r : Exp)])</span></p><p class="c3"><span class="c41"></span></p><p class="c5"><span class="c41">(define-type Value</span></p><p class="c5"><span class="c41">  (numV (n : Number))</span></p><p class="c5"><span class="c41">  (strV (s : String)))</span></p><p class="c3"><span class="c41"></span></p><p class="c5"><span class="c41">(calc : (Exp -&gt; Value))</span></p><p class="c3"><span class="c41"></span></p><p class="c5"><span class="c41">(define (calc e)</span></p><p class="c5"><span class="c41">  (type-case Exp e</span></p><p class="c5"><span class="c41">    [(num n) (numV n)]</span></p><p class="c5"><span class="c41">    [(str s) (strV s)]</span></p><p class="c5"><span class="c41">    [(plus l r) (num+ (calc l) (calc r))]</span></p><p class="c5"><span class="c41">    [(cat l r) (str++ (calc l) (calc r))]))</span></p><p class="c3"><span class="c41"></span></p><p class="c5"><span class="c41">(define (num+ lv rv)</span></p><p class="c5"><span class="c41">  (type-case Value lv</span></p><p class="c5"><span class="c41">    ((numV ln)</span></p><p class="c5"><span class="c41">     (type-case Value rv</span></p><p class="c5"><span class="c41">       ((numV rn) (numV (+ ln rn)))</span></p><p class="c5"><span class="c41">       (else (error '+ "right not a number"))))</span></p><p class="c5"><span class="c41">    (else (error '+ "left not a number"))))</span></p><p class="c3"><span class="c41"></span></p><p class="c5"><span class="c41">(define (str++ lv rv)</span></p><p class="c5"><span class="c41">  (type-case Value lv</span></p><p class="c5"><span class="c41">    ((strV ls)</span></p><p class="c5"><span class="c41">     (type-case Value rv</span></p><p class="c5"><span class="c41">       ((strV rs) (strV (string-append ls rs)))</span></p><p class="c5"><span class="c41">       (else (error '++ "right not a string"))))</span></p><p class="c5"><span class="c41">    (else (error '++ "left not a string"))))</span></p><p class="c3"><span class="c41"></span></p><p class="c5"><span class="c4">You might have imagined the latter two functions to be merely convenient helpers, and hence wonder why they are part of the “core”. You will soon see why!</span></p><p class="c3"><span class="c4"></span></p><p class="c5"><span class="c4">With a suitable parser, we can run tests such as the following:</span></p><p class="c3"><span class="c4"></span></p><p class="c5"><span class="c41">(test (calc (plus (num 1) (num 2))) (numV 3))</span></p><p class="c5"><span class="c41">(test (calc (plus (num 1) (plus (num 2) (num 3)))) (numV 6))</span></p><p class="c5"><span class="c41">(test (calc (cat (str "hel") (str "lo"))) (strV "hello"))</span></p><p class="c5"><span class="c41">(test (calc (cat (cat (str "hel") (str "l")) (str "o"))) (strV "hello"))</span></p><p class="c5"><span class="c41">(test/exn (calc (cat (num 1) (str "hello"))) "left")</span></p><p class="c5"><span class="c41">(test/exn (calc (plus (num 1) (str "hello"))) "right")</span></p><p class="c3"><span class="c41"></span></p><p class="c5"><span class="calibre3">The last two, in particular, show that the language is safe. The checks inside the primitives—in </span><span class="c28">num+</span><span class="calibre3">, for instance—are called </span><span class="c7">safety checks</span><span class="c4">.</span></p></body></html>
