<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Unknown</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <link rel="stylesheet" type="text/css" href="stylesheet.css"/>
<link rel="stylesheet" type="text/css" href="page_styles.css"/>
</head>
  <body class="c">
<h2 class="c27" id="h.hg5aqh9ojfl1"><span class="c4">Static Members</span></h2><p class="c3"><span class="c4"></span></p><p class="c5"><span class="c4">Another feature often valuable to users of objects is static members: those that are common to all instances of the same type of object. This, however, is merely a lexically-scoped identifier (making it private) that lives outside the constructor (making it common to all uses of the constructor).</span></p><p class="c3"><span class="c4"></span></p><p class="c5"><span class="calibre3">Suppose we want to keep a count of how many instances of a kind of object are created. This count cannot be inside any one of those objects, because they would not “know” about each other; rather, the constructor needs to keep track of this. This is the role of static members, and the variable </span><span class="c28">counter</span><span class="c4"> plays this role in the following example:</span></p><p class="c3"><span class="c4"></span></p><p class="c5"><span class="c41">(define mk-o-static</span></p><p class="c5"><span class="c41">  (let ([counter 0])</span></p><p class="c5"><span class="c41">    (lambda (amount)</span></p><p class="c5"><span class="c41">      (begin</span></p><p class="c5"><span class="c41">        (set! counter (+ 1 counter))</span></p><p class="c5"><span class="c41">        (lambda (m)</span></p><p class="c5"><span class="c41">          (case m</span></p><p class="c5"><span class="c41">            [(inc) (lambda (n) (set! amount (+ amount n)))]</span></p><p class="c5"><span class="c41">            [(dec) (lambda (n) (set! amount (- amount n)))]</span></p><p class="c5"><span class="c41">            [(get) (lambda () amount)]</span></p><p class="c5"><span class="c41">            [(count) (lambda () counter)]))))))</span></p><p class="c3"><span class="c4"></span></p><p class="c5"><span class="c4">We’ve written the counter increment where the “constructor” for this object would go, though it could just as well be manipulated inside the methods.</span></p><p class="c3"><span class="c4"></span></p><p class="c5"><span class="c4">To test it, we should make multiple objects and ensure they each affect the global count:</span></p><p class="c3"><span class="c4"></span></p><p class="c5"><span class="c41">(test (let ([o (mk-o-static 1000)])</span></p><p class="c5"><span class="c41">        (msg o 'count))</span></p><p class="c5"><span class="c41">      1)</span></p><p class="c5"><span class="c41"> </span></p><p class="c5"><span class="c41">(test (let ([o (mk-o-static 0)])</span></p><p class="c5"><span class="c41">        (msg o 'count))</span></p><p class="c5"><span class="c41">      2)</span></p><p class="c3"><span class="c4"></span></p><p class="c5"><span class="c4">It is productive to see how this program runs through the Stacker. For simplicity, we can ignore most of the details and focus just on the core static pattern. Here is a Stacker-friendly translation:</span></p><p class="c3"><span class="c4"></span></p><p class="c5"><span class="c41">#lang stacker/smol/hof</span></p><p class="c3"><span class="c41"></span></p><p class="c5"><span class="c41">(defvar mk-o-static</span></p><p class="c5"><span class="c41">  (let ([counter 0])</span></p><p class="c5"><span class="c41">    (lambda (amount)</span></p><p class="c5"><span class="c41">      (begin</span></p><p class="c5"><span class="c41">        (set! counter (+ 1 counter))</span></p><p class="c5"><span class="c41">        (lambda (m)</span></p><p class="c5"><span class="c41">          (if (equal? m "get")</span></p><p class="c5"><span class="c41">              (lambda () amount)</span></p><p class="c5"><span class="c41">              (if (equal? m "count")</span></p><p class="c5"><span class="c41">                  counter</span></p><p class="c5"><span class="c41">                  (error "no such member"))))))))</span></p><p class="c3"><span class="c41"></span></p><p class="c5"><span class="c41">(defvar o1 (mk-o-static 1000))</span></p><p class="c5"><span class="c41">(defvar o2 (mk-o-static 0))</span></p><p class="c5"><span class="c41">(o1 "count")</span></p><p class="c5"><span class="c41">(o2 "count")</span></p><p class="c3"><span class="c4"></span></p><p class="c5"><span class="c4">Run this and see how the static member works!</span></p></body></html>
